<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadísticas - TakumiNet</title>
    <link rel="stylesheet" href="src/estadisticas.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/png" href="../assets/img/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/">
    <style>
/* Configuración de la barra de navegación */
.config-navbar {
    display: flex;
    align-items: center;
    justify-content: start;
    padding: 1rem 2rem;
    background-color: #1B1B1B; /* Fondo oscuro profesional */
    color: #ffffff;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    gap: 1rem;
    border-bottom: 2px solid #00ff0d; /* Línea morada decorativa */
}

.back-btn {
    color: #ffffff;
    font-size: 1.5rem;
    text-decoration: none;
    transition: color 0.3s ease;
}

.back-btn:hover {
    color: #17ff02; /* Morado hover */
}

.config-title {
    font-size: 1.4rem;
    font-weight: 600;
    margin: 0;
    color: #f3f4f6;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}







        .stars {
  display: flex;
  justify-content: center;
  gap: 4px;
  margin-top: 5px;
}
.stars span {
  font-size: 1.5rem;
  color: #ccc;
}
.stars span.filled {
  color: gold;
}






/* ==========================
   Sección de seguidos
   ========================== */
.followed-section {
  max-width: 500px;
  margin: 20px auto;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #fff; /* texto blanco */
  background-color: #2c2c2c; /* fondo gris oscuro */
  padding: 16px;
  border-radius: 12px;
}

/* Título */
.followed-section h2 {
  font-size: 1.5rem;
  margin-bottom: 12px;
  border-bottom: 2px solid #444;
  padding-bottom: 6px;
}

/* ==========================
   Lista de seguidos
   ========================== */
.followed-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.followed-list li {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: #3a3a3a; /* gris más claro que el fondo */
  padding: 8px 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  transition: background 0.2s;
  color: #fff;
}

.followed-list li:hover {
  background-color: #4a4a4a;
}

/* ==========================
   Avatar
   ========================== */
.avatar {
  width: 32px;
  height: 32px;
  min-width: 32px;
  min-height: 32px;
  border-radius: 50%;
  background-color: #555; /* gris claro */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  color: #fff;
  margin-right: 10px;
}

/* ==========================
   Nombre de usuario
   ========================== */
.followed-list span {
  font-weight: 500;
  color: #fff;
}

/* ==========================
   Botón dejar de seguir
   ========================== */
.followed-list button {
  padding: 4px 10px;
  font-size: 0.85rem;
  border: 1px solid #4caf50;
  background-color: #4caf50; /* verde */
  color: #fff; /* letra blanca */
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.followed-list button:hover {
  background-color: #45a049;
  border-color: #45a049;
}

.followed-list button:active {
  transform: scale(0.97);
}

    </style>

</head>
<body>
<nav class="config-navbar">
    <!-- Botón Volver -->
    <a href="Creator Dashboard.html" class="back-btn" 
       title="Volver al panel" 
       data-i18n-title="config.backToDashboard">
        <i class="fas fa-arrow-left"></i>
        <span class="config-title" data-i18n="config.back">Volver</span>
    </a>
</nav>

<section class="followed-section" aria-labelledby="followed-title">
    <h2 id="followed-title" data-i18n="followed.title">Personas que sigues</h2>

    <ul id="followed-list" class="followed-list" role="list">
        <li data-i18n="followed.loading">Cargando...</li>
    </ul>
</section>



<script>
(async function() {
  const API_BASE = "http://localhost:3001";

  // Obtener el ID de usuario de la sesión
  const userId = sessionStorage.getItem("userId");
  const lista = document.getElementById("followed-list");

  // Verificar si el usuario ha iniciado sesión
  if (!userId) {
    if (lista) {
      lista.innerHTML = "<li>No has iniciado sesión</li>";
    }
    return;
  }

  // Mostrar mensaje de carga
  if (lista) {
    lista.innerHTML = "<li>Cargando...</li>";
  }

  try {
    // Obtener la lista de usuarios seguidos
    const res = await fetch(`${API_BASE}/api/seguidos/${userId}`);
    
    // Verificar si la respuesta es exitosa
    if (!res.ok) {
      throw new Error(`Error HTTP: ${res.status}`);
    }
    
    const data = await res.json();

    // Verificar si la respuesta de la API es correcta
    if (!data.ok) {
      if (lista) {
        lista.innerHTML = "<li>Error al cargar seguidos</li>";
      }
      return;
    }

    // Verificar si hay usuarios seguidos
    if (!data.seguidos || data.seguidos.length === 0) {
      if (lista) {
        lista.innerHTML = "<li>No sigues a nadie todavía</li>";
      }
      return;
    }

    // Limpiar la lista y mostrar los usuarios seguidos
    if (lista) {
      lista.innerHTML = "";

      data.seguidos.forEach(user => {
        const li = document.createElement("li");
        li.style.cssText = `
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 12px;
          padding: 10px;
          border-radius: 8px;
          background-color: #f5f5f5;
          transition: background-color 0.2s;
        `;
        
        li.onmouseover = () => {
          li.style.backgroundColor = '#e9e9e9';
        };
        
        li.onmouseout = () => {
          li.style.backgroundColor = '#f5f5f5';
        };

        // Contenedor para avatar y nombre
        const userInfoContainer = document.createElement("div");
        userInfoContainer.style.cssText = `
          display: flex;
          align-items: center;
          cursor: pointer;
          flex-grow: 1;
        `;

        // Avatar
        const avatarDiv = document.createElement("div");
        avatarDiv.className = "avatar";
        avatarDiv.style.cssText = `
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background-color: #ddd;
          display: flex;
          align-items: center;
          justify-content: center;
          margin-right: 12px;
          overflow: hidden;
        `;

        // Si el usuario tiene avatar, mostrarlo
        if (user.avatar) {
          avatarDiv.innerHTML = `<img src="${user.avatar}" alt="Avatar" style="width:100%; height:100%; object-fit:cover;">`;
        } else {
          const avatarIcon = document.createElement("i");
          avatarIcon.className = "fas fa-user";
          avatarIcon.style.color = "#666";
          avatarDiv.appendChild(avatarIcon);
        }

        // Nombre de usuario
        const nombre = document.createElement("span");
        nombre.textContent = user.username || "Usuario sin nombre";
        nombre.style.cssText = `
          font-weight: 500;
          color: #333;
          transition: color 0.2s;
        `;

        // Efecto hover en el nombre
        nombre.onmouseover = () => {
          nombre.style.color = '#007bff';
        };
        
        nombre.onmouseout = () => {
          nombre.style.color = '#333';
        };

        // Función para abrir perfil - CORREGIDO: va a perfiles.html
        const abrirPerfil = () => {
          window.location.href = `perfiles.html?usuarioId=${user.id}`;
        };

        // Asignar evento de clic al contenedor de información de usuario
        userInfoContainer.onclick = abrirPerfil;

        // Agregar elementos al contenedor de información
        userInfoContainer.appendChild(avatarDiv);
        userInfoContainer.appendChild(nombre);

        // Botón de dejar de seguir
        const boton = document.createElement("button");
        boton.textContent = "Dejar de seguir";
        boton.style.cssText = `
          background-color: #ff4d4d;
          color: white;
          border: none;
          padding: 6px 12px;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          transition: background-color 0.2s;
        `;
        
        boton.onmouseover = () => {
          boton.style.backgroundColor = '#ff3333';
        };
        
        boton.onmouseout = () => {
          boton.style.backgroundColor = '#ff4d4d';
        };

        // Evento para dejar de seguir
        boton.onclick = async (e) => {
          e.stopPropagation(); // Evitar que el clic se propague al contenedor principal
          
          try {
            const resp = await fetch(`${API_BASE}/api/seguir`, {
              method: "DELETE", // Usar DELETE para dejar de seguir
              headers: { 
                "Content-Type": "application/json",
                "Authorization": `Bearer ${sessionStorage.getItem("token")}`
              },
              body: JSON.stringify({ 
                user_id: userId, 
                seguido_id: user.id 
              })
            });
            
            const result = await resp.json();
            
            if (result.ok) {
              // Eliminar el elemento de la lista
              li.style.opacity = "0";
              li.style.transition = "opacity 0.3s";
              
              setTimeout(() => {
                li.remove();
                
                // Si no quedan más elementos, mostrar mensaje
                if (lista.children.length === 0) {
                  lista.innerHTML = "<li>No sigues a nadie todavía</li>";
                }
              }, 300);
            } else {
              alert("No se pudo dejar de seguir: " + (result.error || "Error desconocido"));
            }
          } catch (error) {
            console.error("Error al dejar de seguir:", error);
            alert("Error al dejar de seguir. Intenta nuevamente.");
          }
        };

        // Agregar elementos al list item
        li.appendChild(userInfoContainer);
        li.appendChild(boton);
        
        // Agregar el list item a la lista
        lista.appendChild(li);
      });
    }

  } catch (err) {
    console.error("Error al cargar seguidos:", err);
    
    if (lista) {
      lista.innerHTML = "<li>Error al cargar la lista de seguidos</li>";
    }
  }
})();
</script>


</body>
</html>