<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="assets/img/logo.png">
<link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/index.css">
  <title>Reset Password - TakumiNet</title>
  <style>
.reset-container {
    max-width: 400px;
    padding: 40px;
    background: rgb(27, 27, 27);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    text-align: center;
    
    /* Centrado absoluto en la página */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
}

.reset-container h2 {
    color: #ffffff;
    margin-bottom: 15px;
    font-size: 24px;
    font-weight: 600;
}

.reset-container p {
    color: #ffffff;
    margin-bottom: 25px;
    line-height: 1.5;
}

.reset-container strong {
    color: #3ffd05;
}

#reset-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

#reset-form input {
    padding: 12px 15px;
    border: 2px solid #1a1a1a;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

#reset-form input:focus {
    outline: none;
    border-color: #00ff4c;
    background: white;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

#reset-form input::placeholder {
    color: #999;
}

#message {
    min-height: 20px;
    font-size: 14px;
    font-weight: 500;
    text-align: center;
    margin: 10px 0;
}

#message.success {
    color: #28a745;
}

#message.error {
    color: #dc3545;
}

#reset-form button {
    padding: 12px;
    background: linear-gradient(135deg, #00ff4c, #161616);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

#reset-form button:hover {
    background: linear-gradient(135deg, #242424, #008507);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(25, 25, 26, 0.3);
}

#reset-form button:active {
    transform: translateY(0);
}

#reset-form button:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.login-link {
    display: block;
    color: #09ff00;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
}

.login-link:hover {
    color: #b1b1b1;
    text-decoration: underline;
}

/* Estilos para estados de validación */
#reset-form input.valid {
    border-color: #28a745;
    background-color: #f8fff9;
}

#reset-form input.invalid {
    border-color: #dc3545;
    background-color: #fff5f5;
}

/* Responsive */
@media (max-width: 480px) {
    .reset-container {
        padding: 30px 20px;
        width: 85%;
    }
    
    .reset-container h2 {
        font-size: 20px;
    }
}

  </style>
</head>
<body>
      <!-- Fondo de partículas -->
  <div id="particles-js"></div>

  <div class="reset-container">
    <h2>Restablecer Contraseña</h2>
    <p>Por favor, ingresa una nueva contraseña para la cuenta <strong>Juliogmer</strong>.</p>
    <form id="reset-form">
      <input type="password" id="password" placeholder="Contraseña" required>
      <input type="password" id="confirm-password" placeholder="Repetir contraseña" required>
      <div id="message"></div>
      <button type="submit">Cambiar Contraseña</button>
    </form>
    <a href="login.html" class="login-link">o Iniciar Sesión</a>
</div>

  <script>
   const form = document.getElementById('reset-form');
const messageDiv = document.getElementById('message');
const passwordInput = document.getElementById('password');
const confirmPasswordInput = document.getElementById('confirm-password');

// Permitir copiar y pegar
passwordInput.addEventListener('paste', (e) => {
    e.preventDefault();
    const text = e.clipboardData.getData('text');
    document.execCommand('insertText', false, text);
});

confirmPasswordInput.addEventListener('paste', (e) => {
    e.preventDefault();
    const text = e.clipboardData.getData('text');
    document.execCommand('insertText', false, text);
});

// Validación en tiempo real
passwordInput.addEventListener('input', validarPassword);
confirmPasswordInput.addEventListener('input', validarConfirmacion);

function validarPassword() {
    const password = passwordInput.value;
    
    // Remover clases anteriores
    passwordInput.classList.remove('valid', 'invalid');
    
    if (password.length === 0) {
        return;
    }
    
    // Validar que tenga letras y números
    const tieneLetras = /[a-zA-Z]/.test(password);
    const tieneNumeros = /[0-9]/.test(password);
    const longitudValida = password.length >= 6;
    
    if (tieneLetras && tieneNumeros && longitudValida) {
        passwordInput.classList.add('valid');
    } else {
        passwordInput.classList.add('invalid');
    }
}

function validarConfirmacion() {
    const password = passwordInput.value;
    const confirmPassword = confirmPasswordInput.value;
    
    // Remover clases anteriores
    confirmPasswordInput.classList.remove('valid', 'invalid');
    
    if (confirmPassword.length === 0) {
        return;
    }
    
    if (password === confirmPassword && password.length >= 6) {
        confirmPasswordInput.classList.add('valid');
    } else {
        confirmPasswordInput.classList.add('invalid');
    }
}

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const password = passwordInput.value;
    const confirmPassword = confirmPasswordInput.value;

    // Validaciones
    if (password.length < 6) {
        messageDiv.textContent = "La contraseña debe tener al menos 6 caracteres.";
        messageDiv.className = "error";
        return;
    }

    if (!/[a-zA-Z]/.test(password)) {
        messageDiv.textContent = "La contraseña debe contener letras.";
        messageDiv.className = "error";
        return;
    }

    if (!/[0-9]/.test(password)) {
        messageDiv.textContent = "La contraseña debe contener números.";
        messageDiv.className = "error";
        return;
    }

    if (password !== confirmPassword) {
        messageDiv.textContent = "Las contraseñas no coinciden.";
        messageDiv.className = "error";
        return;
    }

    // Obtener token de la URL
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');

    if (!token) {
        messageDiv.textContent = "Token inválido.";
        messageDiv.className = "error";
        return;
    }

    try {
        // Cambiar a tu endpoint real
        const res = await fetch("http://localhost:3001/api/user/reset-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                token: token, 
                password: password 
            })
        });
        
        const data = await res.json();

        if (data.ok) {
            messageDiv.textContent = "✅ Contraseña cambiada correctamente. Redirigiendo...";
            messageDiv.className = "success";
            setTimeout(() => window.location.href = "login.html", 2000);
        } else {
            messageDiv.textContent = "❌ " + (data.error || "Error al cambiar contraseña");
            messageDiv.className = "error";
        }
    } catch (err) {
        console.error("Error:", err);
        messageDiv.textContent = "❌ Error de conexión. Intenta nuevamente.";
        messageDiv.className = "error";
    }
});
  </script>
  
  <!-- Scripts de partículas -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="js/particulas.js"></script>
</body>
</html>
